
<?xml version="1.0" encoding="UTF-8"?>
<data>
  <action>
    function checkWyrmQuest(player){
    return true;
    }
  </action>
  <structure id="wyrm_storehouse" width="48" height="32" image="{core}/magic1/structures/wyrm_door.png" type="storehouse" main="true" title="common.storehouse">
    <tooltip id="storehouse" />
  </structure>
  <animation id="wyrm_queen.over" x="32" count="5"/>
  <animation id="wyrm_queen.talk" equals="wyrm_queen.idle"/>
  <npc id="wyrm_house" tile="wyrm_queen" animation="wyrm_queen" tileWidth="5" tileHeight="2.8" action="enter" stopForPlayer="false" icon="wyrm_queen.ico" indicatorX="-25" indicatorY="-10" fullHeight="true">
    <operate>
      <section>
        <quest if="getWyrmQuest(player)"/>
      <menu section="common" yalign="0.5" closeable="true">
      <choice id='talk'>
        <run procedure="wyrm_quests"/>
      </choice>
      <choice id='sleep_day'>
        <action> player.fullRestore(); </action>
        <save sleep="true"/>
      </choice>
      <choice id='sleep_night'>
        <action> player.fullRestore(); </action>
        <save toNight="true"/>
      </choice>
    </menu>
  </section>
    </operate>
  </npc>

  <!-- <structure id="wyrm_quest" width="16" height="16" fullHeight="true" name="enter">
    <tile id="magic_orb" animation="magic_orb.idle" x="-1.5" y="-1.5"/>
    <operate>
      <dialogue section="wyrm_tales" id="quests0" if="!getFlag('wyrm_tales_quests0')"/>
      <action>
          ev.getString = getString;
          ev.setString = setString;
          ev.getGlobal = getGlobal;
          ev.setGlobal = setGlobal;
          ev.getFlag = getFlag;
          ev.setFlag = setFlag;
          ev.player = player;
          ev.evalXml = evalXml;
          ev.setBack = setBack;
      </action>
      <action>
        setFlag('wyrm_tales_quests0',true);
        str = '&lt;window type="craft" title="common.select_quest">';
        for (q in getDataByType('wyrmQuest')){
          str += listQuest(q,player);
        }
      str += "&lt;/window>";
      evalXml(str);
     </action>
   </operate>
 </structure>

  <action>function wyrmQuest(v,player){player.setFlag("wyrm_quest",v); if(getGlobal("tales_queen") != null) getGlobal("tales_queen").updateRenderer();}</action> -->
  <structure id="WTgolem" width="128" height="64" tile="doorway" name="activate" animation="golem.statue">
		<tile id="golem.statue" x="-3" y="0" />
		<tile id="golem.statue" x="1" y="0" />
		<operate><section if="!getFlag('WTGolemStatue') && ! getFlag('learnGolem')"><action>flaggy('WTGolemStatue')</action><dialogue section="golem" id="wonder"/><stop/></section><set id="gem" value="'earth_gem'" /><set id="into" value="'golem.active'" /><set id="achievement" value="null" /><set id="sfx" value="null" /><run procedure="activate.gem_structure" /></operate>
	</structure>
	<structure id="WTgolem.active" width="128" height="64" tile="doorway" name="enter" animation="golem.statue">
		<tile id="golem.statue" name="left" lerp="true" x="-3" y="0" />
		<tile id="golem.statue" name="right" lerp="true" x="1" y="0" />
		<over>
			<lerp object="this.getTileById('left')" modal="false" x="-1" seconds="1" />
			<lerp object="this.getTileById('right')" modal="false" x="1" seconds="1" />
			<action>this.playSFX("rock_door", false);</action>
		</over>
		<out>
			<lerp object="this.getTileById('left')" modal="false" x="0" seconds="1" />
			<lerp object="this.getTileById('right')" modal="false" x="0" seconds="1" />
			<action>this.playSFX("rock_door", false);</action>
		</out>
		<operate><teleport area="WTgolem_factory" x="2" y="6" with="ellipse" /></operate>
	</structure>


  <structure id='tales_wyrm_tunnel' width='16' height='16' image="{core}/magic1/structures/wyrm_tunnel.png" name="enter" type="door" allowReturn="true">
    <afterTeleport><dig x="player.tile_x" y="player.tile_y" speed="2" /></afterTeleport>
  </structure>

  <!-- <structure id='wyrm_tales_teleport_main' width='16' height='16' image="{core}/magic1/structures/wyrm_tunnel.png" name="enter" allowReturn="false">
    <operate>
      <choose>
        <return if="player.prevLocation != null" with="ellipse"/>
        <teleport area="wyrm_tales.main" x="1" y="-1" with="ellipse"/>
      </choose>
   </operate>
  </structure> -->
</data>
