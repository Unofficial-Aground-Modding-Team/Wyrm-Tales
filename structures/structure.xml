<?xml version="1.0" encoding="UTF-8"?>
<data>

  <structure id="wyrm_storehouse" width="48" height="32" image="{core}/magic1/structures/wyrm_door.png" type="storehouse" main="true" title="common.storehouse">
    <tooltip id="storehouse"/>
  </structure>
  <animation id="wyrm_queen.over" x="32" count="5"/>
  <animation id="wyrm_queen.talk" equals="wyrm_queen.idle"/>
  <npc id="wyrm_house" tile="wyrm_queen" animation="wyrm_queen" tileWidth="5" tileHeight="2.8" action="enter" stopForPlayer="false" icon="wyrm_queen.ico" indicatorX="-25" indicatorY="-10" fullHeight="true">
    <init>
      <action>
        function hasWyrmQuest(){
          for(o in wyrm_quests.elementsNamed("choose").next().elementsNamed("section")) 
            if(eval(o.get("if")) == true) return true;
          return false;
        }
      </action>
    </init>
    <operate>
      <section if="hasWyrmQuest()">
        <quest/>
        <run procedure="wyrm_quests"/>
      </section>
      <section>
        <menu section="common" closeable="true">
          <choice id="talk">
            <run procedure="wyrm_quests"/>
          </choice>
          <choice id="sleep_day">
            <action>player.fullRestore();</action>
            <save sleep="true" />
          </choice>
          <choice id="sleep_night">
            <action>player.fullRestore();</action>
            <save toNight="true" />
          </choice>
        </menu>
      </section>
    </operate>
  </npc>

  <structure id="WTgolem" width="128" height="64" tile="doorway" name="activate" animation="golem.statue">
    <tile id="golem.statue" x="-3" y="0" />
    <tile id="golem.statue" x="1" y="0" />
    <operate>
      <dialogue section="warning" id="incomplete"/>
      <stop/>
      <!-- <section if="!getFlag('WTGolemStatue') && !getFlag('learnGolem')">
        <action>if (!getFlag('WTGolemStatue')){setFlag('WTGolemStatue',true);}</action>
        <dialogue section="golem" id="wonder"/>
        <stop/>
      </section>
      <set id="gem" value="'earth_gem'" />
      <set id="into" value="'WTgolem.active'" />
      <set id="achievement" value="null" />
      <set id="sfx" value="null" />
      <run procedure="activate.gem_structure" /> -->
    </operate>
  </structure>
  <structure id="WTgolem.active" width="128" height="64" tile="doorway" name="enter" animation="golem.statue">
    <tile id="golem.statue" name="left" lerp="true" x="-3" y="0" />
    <tile id="golem.statue" name="right" lerp="true" x="1" y="0" />
    <over>
      <lerp object="this.getTileById('left')" modal="false" x="-1" seconds="1" />
      <lerp object="this.getTileById('right')" modal="false" x="1" seconds="1" />
      <action>this.playSFX("rock_door", false);</action>
    </over>
    <out>
      <lerp object="this.getTileById('left')" modal="false" x="0" seconds="1" />
      <lerp object="this.getTileById('right')" modal="false" x="0" seconds="1" />
      <action>this.playSFX("rock_door", false);</action>
    </out>
    <operate>
      <teleport area="WTgolem_factory" x="2" y="6" with="ellipse" />
    </operate>
  </structure>

  <structure id='tales_wyrm_tunnel' width='16' height='16' image="{core}/magic1/structures/wyrm_tunnel.png" name="enter" type="door">
    <afterTeleport>
      <dig x="player.tile_x" y="player.tile_y" speed="2" />
    </afterTeleport>
  </structure>
</data>
