<data>
  <procedure id='WT_door_check'><choose>
    <section if="getFlag('WT_welcome_golem')"><choose>
      <section if="getFlag('WT_welcome_wyrm')">
        <structure id='wyrm_tales_teleport_main' x='14' y='7'/>
      </section>
      <dialogue section='wyrm_tales' id='talk_to_wyrm' speaker='player'/></choose>
    </section>
    <dialogue section='wyrm_tales' id='talk_to_golemech' speaker='player'/></choose>
  </procedure>

  <npc id="wyrm_tutorial_npc" tile='golemech' animation='golemech' idle_anim='golemech.sleep' action="talk" talk_sfx="talking7" stopForPlayer="false" >
    <operate>
      <choose>
        <section if="!getFlag('welcome')">
          <dialogue section="wyrm_tutorial_npc" id="welcome" speaker="this" />
          <dialogue section="wyrm_tutorial_npc" id="tip1" speaker="this" />
          <dialogue section="wyrm_tutorial_npc" id="tip2" speaker="this" />
          <dialogue section="wyrm_tutorial_npc" id="colors1" speaker="this" />
          <dialogue section="wyrm_tutorial_npc" id="colors2" speaker="this" />
          <dialogue section="wyrm_tutorial_npc" id="door" speaker="this" />
            <section if="!getFlag('WT_welcome_wyrm')">
              <dialogue section="wyrm_tutorial_npc" id="door2" speaker="player"/>
              <dialogue section="wyrm_tutorial_npc" id="door3" speaker="this" />
            </section>
          <action> setFlag('WT_welcome_golem', true); </action>
          <run procedure="WT_door_check"/>
        </section>
          <group>
            <dialogue section="wyrm_tutorial_npc" id="tip1" speaker="this" />
            <dialogue section="wyrm_tutorial_npc" id="tip2" speaker="this" />
            <dialogue section="wyrm_tutorial_npc" id="colors1" speaker="this" />
            <dialogue section="wyrm_tutorial_npc" id="colors2" speaker="this" />
          </group>
    </choose>
    </operate>
  </npc>

  <npc id="wyrm_tutorial_familiar" tile='wyrm' animation='wyrm' action='talk' talk_sfx='talking7' stopForPlayer='false'>
    <operate>
      <section>
        <set id='familiar_npc' value="player.area.getNPC('wyrm_tutorial_familiar')"/>
        <!-- var familiar_npc = player.area.getNPC('wyrm_tutorial_familiar');</action> -->
        <dialogue section='wyrm_tutorial_npc' id='new_familiar' speaker='this'/>
        <dialogue section='wyrm_tutorial_npc' id='familiar_what' speaker='player'/>
        <action> setFlag('WT_welcome_wyrm', true); </action>
          <menu section="common" yalign="0.5" closeable="false">
          <choice id='yes'>
            <equip id='wyrm0' fromInventory="false"/>
            <dialogue section='wyrm_tutorial_npc' id='familiar_yay' speaker='this'/>
            <remove object="familiar_npc" />
          </choice>
          <choice id='no'>
            <dialogue section='wyrm_tutorial_npc' id='familiar_too_bad' speaker='this'/>
            <dialogue section='wyrm_tales' id='fuck' speaker='player'/>
            <equip id='wyrm0' fromInventory="false"/>
            <dialogue section='wyrm_tutorial_npc' id='familiar_too_bad2' speaker='this'/>
            <remove object="familiar_npc" />
          </choice>
        </menu>
        <run procedure="WT_door_check"/>
      </section>
    </operate>
  </npc>

</data>
